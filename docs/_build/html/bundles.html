

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Bundles &mdash; BundleWrap 2.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/bundlewrap.css" type="text/css" />
  

  

  
        <link rel="author" title="About these documents"
              href="about.html"/>
    <link rel="top" title="BundleWrap 2.0.0 documentation" href="index.html"/>
        <link rel="up" title="Repository reference" href="repository.html"/>
        <link rel="next" title="Actions" href="item_action.html"/>
        <link rel="prev" title="groups.py" href="groups.py.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html">
        

        
          
          <img src="_static/logo.png" class="logo" />
        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#create-a-repository">Create a repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#run-a-command">Run a command</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#create-a-bundle">Create a bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#create-a-file-template">Create a file template</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#apply-configuration">Apply configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#further-reading">Further reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#using-pip">Using <cite>pip</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#from-git">From git</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Requirements for managed systems</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="repository.html">Repository reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="nodes.py.html">nodes.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="groups.py.html">groups.py</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Bundles</a></li>
<li class="toctree-l2"><a class="reference internal" href="hooks.html">Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_item.html">Custom item types</a></li>
<li class="toctree-l2"><a class="reference internal" href="libs.html">Custom code</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins.html">Plugins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cli.html#bw-apply"><code class="docutils literal"><span class="pre">bw</span> <span class="pre">apply</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#bw-run"><code class="docutils literal"><span class="pre">bw</span> <span class="pre">run</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#bw-nodes-and-bw-groups"><code class="docutils literal"><span class="pre">bw</span> <span class="pre">nodes</span></code> and <code class="docutils literal"><span class="pre">bw</span> <span class="pre">groups</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#bw-debug"><code class="docutils literal"><span class="pre">bw</span> <span class="pre">debug</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#bw-plot"><code class="docutils literal"><span class="pre">bw</span> <span class="pre">plot</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#bw-test"><code class="docutils literal"><span class="pre">bw</span> <span class="pre">test</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dev_contrib.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dev_contrib.html#submitting-bug-reports">Submitting bug reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_contrib.html#contributing-code">Contributing code</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_contrib.html#help">Help</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="faq.html#technical">Technical</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#the-bundlewrap-project">The BundleWrap Project</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="alternatives.html">Alternatives</a><ul>
<li class="toctree-l2"><a class="reference internal" href="alternatives.html#ansible">Ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="alternatives.html#bcfg2">BCFG2</a></li>
<li class="toctree-l2"><a class="reference internal" href="alternatives.html#chef">Chef</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">BundleWrap</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="repository.html">Repository reference</a> &raquo;</li>
      
    <li>Bundles</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="bundles">
<span id="id1"></span><h1>Bundles<a class="headerlink" href="#bundles" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>Bundles are subdirectories of the <code class="file docutils literal"><span class="pre">bundles/</span></code> directory of your BundleWrap repository. Within each bundle, there must be a file called <code class="file docutils literal"><span class="pre">items.py</span></code>. It defines any number of magic attributes that are automatically processed by BundleWrap. Each attribute is a dictionary mapping an item name (such as a file name) to a dictionary of attributes (e.g. file ownership information).</p>
<p>A typical bundle might look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">files</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;/etc/hosts&#39;</span><span class="p">:</span> <span class="p">{</span>
         <span class="s">&#39;owner&#39;</span><span class="p">:</span> <span class="s">&quot;root&quot;</span><span class="p">,</span>
         <span class="s">&#39;group&#39;</span><span class="p">:</span> <span class="s">&quot;root&quot;</span><span class="p">,</span>
         <span class="s">&#39;mode&#39;</span><span class="p">:</span> <span class="s">&quot;0664&quot;</span><span class="p">,</span>
         <span class="p">[</span><span class="o">...</span><span class="p">]</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;janedoe&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;home&#39;</span><span class="p">:</span> <span class="s">&quot;/home/janedoe&quot;</span><span class="p">,</span>
        <span class="s">&#39;shell&#39;</span><span class="p">:</span> <span class="s">&quot;/bin/zsh&quot;</span><span class="p">,</span>
        <span class="p">[</span><span class="o">...</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s">&#39;johndoe&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;home&#39;</span><span class="p">:</span> <span class="s">&quot;/home/johndoe&quot;</span><span class="p">,</span>
        <span class="s">&#39;shell&#39;</span><span class="p">:</span> <span class="s">&quot;/bin/bash&quot;</span><span class="p">,</span>
        <span class="p">[</span><span class="o">...</span><span class="p">]</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This bundle defines the attributes <code class="docutils literal"><span class="pre">files</span></code> and <code class="docutils literal"><span class="pre">users</span></code>. Within the <code class="docutils literal"><span class="pre">users</span></code> attribute, there are two <code class="docutils literal"><span class="pre">user</span></code> items. Each item maps its name to a dictionary that is understood by the specific kind of item. Below you will find a reference of all builtin item types and the attributes they understand. You can also <a class="reference internal" href="dev_item.html"><em>define your own item types</em></a>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="item-types">
<span id="id2"></span><h2>Item types<a class="headerlink" href="#item-types" title="Permalink to this headline">¶</a></h2>
<p>This table lists all item types included in BundleWrap along with the bundle attributes they understand.</p>
<style type="text/css">.wy-table-responsive table td { vertical-align: top !important; white-space: normal !important; }</style><table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="13%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type name</th>
<th class="head">Bundle attribute</th>
<th class="head">Purpose</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="item_action.html"><em>action</em></a></td>
<td><code class="docutils literal"><span class="pre">actions</span></code></td>
<td>Actions allow you to run commands on every <code class="docutils literal"><span class="pre">bw</span> <span class="pre">apply</span></code></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="item_directory.html"><em>directory</em></a></td>
<td><code class="docutils literal"><span class="pre">directories</span></code></td>
<td>Manages permissions and ownership for directories</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="item_file.html"><em>file</em></a></td>
<td><code class="docutils literal"><span class="pre">files</span></code></td>
<td>Manages contents, permissions, and ownership for files</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="item_group.html"><em>group</em></a></td>
<td><code class="docutils literal"><span class="pre">groups</span></code></td>
<td>Manages groups by wrapping <code class="docutils literal"><span class="pre">groupadd</span></code>, <code class="docutils literal"><span class="pre">groupmod</span></code> and <code class="docutils literal"><span class="pre">groupdel</span></code></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="item_pkg_apt.html"><em>pkg_apt</em></a></td>
<td><code class="docutils literal"><span class="pre">pkg_apt</span></code></td>
<td>Installs and removes packages with APT</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="item_pkg_pacman.html"><em>pkg_pacman</em></a></td>
<td><code class="docutils literal"><span class="pre">pkg_pacman</span></code></td>
<td>Installs and removes packages with pacman</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="item_pkg_pip.html"><em>pkg_pip</em></a></td>
<td><code class="docutils literal"><span class="pre">pkg_pip</span></code></td>
<td>Installs and removes Python packages with pip</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="item_pkg_yum.html"><em>pkg_yum</em></a></td>
<td><code class="docutils literal"><span class="pre">pkg_yum</span></code></td>
<td>Installs and removes packages with yum</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="item_pkg_zypper.html"><em>pkg_zypper</em></a></td>
<td><code class="docutils literal"><span class="pre">pkg_zypper</span></code></td>
<td>Installs and removes packages with zypper</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="item_postgres_db.html"><em>postgres_db</em></a></td>
<td><code class="docutils literal"><span class="pre">postgres_dbs</span></code></td>
<td>Manages Postgres databases</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="item_postgres_role.html"><em>postgres_role</em></a></td>
<td><code class="docutils literal"><span class="pre">postgres_roles</span></code></td>
<td>Manages Postgres roles</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="item_pkg_pip.html"><em>pkg_pip</em></a></td>
<td><code class="docutils literal"><span class="pre">pkg_pip</span></code></td>
<td>Installs and removes Python packages with pip</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="item_svc_upstart.html"><em>svc_upstart</em></a></td>
<td><code class="docutils literal"><span class="pre">svc_upstart</span></code></td>
<td>Starts and stops services with Upstart</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="item_svc_systemd.html"><em>svc_systemd</em></a></td>
<td><code class="docutils literal"><span class="pre">svc_systemd</span></code></td>
<td>Starts and stops services with systemd</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="item_svc_systemv.html"><em>svc_systemv</em></a></td>
<td><code class="docutils literal"><span class="pre">svc_systemv</span></code></td>
<td>Starts and stops services with traditional System V init scripts</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="item_symlink.html"><em>symlink</em></a></td>
<td><code class="docutils literal"><span class="pre">symlinks</span></code></td>
<td>Manages symbolic links and their ownership</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="item_user.html"><em>user</em></a></td>
<td><code class="docutils literal"><span class="pre">users</span></code></td>
<td>Manages users by wrapping <code class="docutils literal"><span class="pre">useradd</span></code>, <code class="docutils literal"><span class="pre">usermod</span></code> and <code class="docutils literal"><span class="pre">userdel</span></code></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="builtin-attributes">
<span id="builtin-item-attributes"></span><h2>Builtin attributes<a class="headerlink" href="#builtin-attributes" title="Permalink to this headline">¶</a></h2>
<p>There are also attributes that can be applied to any kind of item.</p>
<div class="section" id="needs">
<h3><code class="docutils literal"><span class="pre">needs</span></code><a class="headerlink" href="#needs" title="Permalink to this headline">¶</a></h3>
<p>One such attribute is <code class="docutils literal"><span class="pre">needs</span></code>. It allows for setting up dependencies between items. This is not something you will have to to very often, because there are already implicit dependencies between items types (e.g. all files depend on all users). Here are two examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">my_items</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;item1&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">[</span><span class="o">...</span><span class="p">]</span>
        <span class="s">&#39;needs&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">&#39;file:/etc/foo.conf&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">},</span>
    <span class="s">&#39;item2&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="o">...</span>
        <span class="s">&#39;needs&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">&#39;pkg_apt:&#39;</span><span class="p">,</span>
            <span class="s">&#39;bundle:foo&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The first item (<code class="docutils literal"><span class="pre">item1</span></code>, specific attributes have been omitted) depends on a file called <code class="file docutils literal"><span class="pre">/etc/foo.conf</span></code>, while <code class="docutils literal"><span class="pre">item2</span></code> depends on all APT packages being installed and every item in the foo bundle.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="needed-by">
<h3><code class="docutils literal"><span class="pre">needed_by</span></code><a class="headerlink" href="#needed-by" title="Permalink to this headline">¶</a></h3>
<p>This attribute is an alternative way of defining dependencies. It works just like <code class="docutils literal"><span class="pre">needs</span></code>, but in the other direction. There are only three scenarios where you should use <code class="docutils literal"><span class="pre">needed_by</span></code> over <code class="docutils literal"><span class="pre">needs</span></code>:</p>
<ul class="simple">
<li>if you need all items a certain type to depend on something or</li>
<li>if you need all items in a bundle to depend on something or</li>
<li>if you need an item in a bundle you can&#8217;t edit (e.g. because it&#8217;s provided by a community-maintained <a class="reference internal" href="plugins.html"><em>plugin</em></a>) to depend on something in your bundles</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="triggers-and-triggered">
<span id="triggers"></span><h3><code class="docutils literal"><span class="pre">triggers</span></code> and <code class="docutils literal"><span class="pre">triggered</span></code><a class="headerlink" href="#triggers-and-triggered" title="Permalink to this headline">¶</a></h3>
<p>In some scenarios, you may want to execute an <a class="reference internal" href="item_action.html#item-action"><span>action</span></a> only when an item is fixed (e.g. restart a daemon after a config file has changed or run <code class="docutils literal"><span class="pre">postmap</span></code> after updating an alias file). To do this, BundleWrap has the builtin atttribute <code class="docutils literal"><span class="pre">triggers</span></code>. You can use it to point to any item that has its <code class="docutils literal"><span class="pre">triggered</span></code> attribute set to <code class="docutils literal"><span class="pre">True</span></code>. Such items will only be checked (or in the case of actions: run) if the triggering item is fixed (or a triggering action completes successfully).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">files</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;/etc/daemon.conf&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">[</span><span class="o">...</span><span class="p">]</span>
        <span class="s">&#39;triggers&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">&#39;action:restart_daemon&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">actions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;restart_daemon&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;command&#39;</span><span class="p">:</span> <span class="s">&quot;service daemon restart&quot;</span><span class="p">,</span>
        <span class="s">&#39;triggered&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above example will run <strong class="command">service daemon restart</strong> every time BundleWrap successfully applies a change to <code class="file docutils literal"><span class="pre">/etc/daemon.conf</span></code>. If an action is triggered multiple times, it will only be run once.</p>
<p>Similar to <code class="docutils literal"><span class="pre">needed_by</span></code>, <code class="docutils literal"><span class="pre">triggered_by</span></code> can be used to define a <code class="docutils literal"><span class="pre">triggers</span></code> relationship from the opposite direction.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="preceded-by">
<span id="id3"></span><h3><code class="docutils literal"><span class="pre">preceded_by</span></code><a class="headerlink" href="#preceded-by" title="Permalink to this headline">¶</a></h3>
<p>Operates like <code class="docutils literal"><span class="pre">triggers</span></code>, but will apply the triggered item <em>before</em> the triggering item. Let&#8217;s look at an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">files</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;/etc/example.conf&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">[</span><span class="o">...</span><span class="p">]</span>
        <span class="s">&#39;preceded_by&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">&#39;action:backup_example&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">actions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;backup_example&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;command&#39;</span><span class="p">:</span> <span class="s">&quot;cp /etc/example.conf /etc/example.conf.bak&quot;</span><span class="p">,</span>
        <span class="s">&#39;triggered&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this configuration, <code class="docutils literal"><span class="pre">/etc/example.conf</span></code> will always be copied before and only if it is changed. You would probably also want to set <code class="docutils literal"><span class="pre">cascade_skip</span></code> to <code class="docutils literal"><span class="pre">False</span></code> on the action so you can skip it in interactive mode when you&#8217;re sure you don&#8217;t need the backup copy.</p>
<p>Similar to <code class="docutils literal"><span class="pre">needed_by</span></code>, <code class="docutils literal"><span class="pre">precedes</span></code> can be used to define a <code class="docutils literal"><span class="pre">preceded_by</span></code> relationship from the opposite direction.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="unless">
<span id="id4"></span><h3><code class="docutils literal"><span class="pre">unless</span></code><a class="headerlink" href="#unless" title="Permalink to this headline">¶</a></h3>
<p>Another builtin item attribute is <code class="docutils literal"><span class="pre">unless</span></code>. For example, it can be used to construct a one-off file item where BundleWrap will only create the file once, but won&#8217;t check or modify its contents once it exists.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">files</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;/path/to/file&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">[</span><span class="o">...</span><span class="p">]</span>
        <span class="s">&quot;unless&quot;</span><span class="p">:</span> <span class="s">&quot;test -x /path/to/file&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This will run <strong class="command">test -x /path/to/file</strong> before doing anything with the item. If the command returns 0, no action will be taken to &#8220;correct&#8221; the item.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Another common use for <code class="docutils literal"><span class="pre">unless</span></code> is with actions that perform some sort of install operation. In this case, the <code class="docutils literal"><span class="pre">unless</span></code> condition makes sure the install operation is only performed when it is needed instead of every time you run <strong class="command">bw apply</strong>. In scenarios like this you will probably want to set <code class="docutils literal"><span class="pre">cascade_skip</span></code> to <code class="docutils literal"><span class="pre">False</span></code> so that skipping the installation (because the thing is already installed) will not cause every item that depends on the installed thing to be skipped. Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">actions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;download_thing&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;command&#39;</span><span class="p">:</span> <span class="s">&quot;wget http://example.com/thing.bin -O /opt/thing.bin &amp;&amp; chmod +x /opt/thing.bin&quot;</span><span class="p">,</span>
        <span class="s">&#39;unless&#39;</span><span class="p">:</span> <span class="s">&quot;test -x /opt/thing.bin&quot;</span><span class="p">,</span>
        <span class="s">&#39;cascade_skip&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s">&#39;run_thing&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;command&#39;</span><span class="p">:</span> <span class="s">&quot;/opt/thing.bin&quot;</span><span class="p">,</span>
        <span class="s">&#39;needs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;action:download_thing&quot;</span><span class="p">],</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="last">If <code class="docutils literal"><span class="pre">action:download_thing</span></code> would not set <code class="docutils literal"><span class="pre">cascade_skip</span></code> to <code class="docutils literal"><span class="pre">False</span></code>, <code class="docutils literal"><span class="pre">action:run_thing</span></code> would only be executed once: directly after the thing has been downloaded. On subsequent runs, <code class="docutils literal"><span class="pre">action:download_thing</span></code> will fail the <code class="docutils literal"><span class="pre">unless</span></code> condition and be skipped. This would also cause all items that depend on it to be skipped, including <code class="docutils literal"><span class="pre">action:run_thing</span></code>.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="cascade-skip">
<h3><code class="docutils literal"><span class="pre">cascade_skip</span></code><a class="headerlink" href="#cascade-skip" title="Permalink to this headline">¶</a></h3>
<p>There are some situations where you don&#8217;t want to default behavior of skipping everything that depends on a skipped item. That&#8217;s where <code class="docutils literal"><span class="pre">cascade_skip</span></code> comes in. Set it to <code class="docutils literal"><span class="pre">False</span></code> and skipping an item won&#8217;t skip those that depend on it. Note that items can be skipped</p>
<ul class="simple">
<li>interactively or</li>
<li>because they haven&#8217;t been <a class="reference internal" href="#triggers"><span>triggered</span></a> or</li>
<li>because one of their dependencies failed or</li>
<li>they failed their <a class="reference internal" href="#unless"><span>&#8216;unless&#8217; condition</span></a> or</li>
<li>because an <a class="reference internal" href="item_action.html"><em>action</em></a> had its <code class="docutils literal"><span class="pre">interactive</span></code> attribute set to <code class="docutils literal"><span class="pre">True</span></code> during a non-interactive run</li>
</ul>
<p>The following example will offer to run an <code class="docutils literal"><span class="pre">apt-get</span> <span class="pre">update</span></code> before installing a package, but continue to install the package even if the update is declined interactively.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">actions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;apt_update&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;cascade_skip&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
        <span class="s">&#39;command&#39;</span><span class="p">:</span> <span class="s">&quot;apt-get update&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">pkg_apt</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;somepkg&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;needs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;action:apt_update&quot;</span><span class="p">],</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">cascade_skip</span></code> defaults to <code class="docutils literal"><span class="pre">True</span></code>. However, if the item uses the <code class="docutils literal"><span class="pre">unless</span></code> attribute or is triggered, the default changes to <code class="docutils literal"><span class="pre">False</span></code>. Most of the time, this is what you&#8217;ll want.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="canned-actions">
<span id="id5"></span><h2>Canned actions<a class="headerlink" href="#canned-actions" title="Permalink to this headline">¶</a></h2>
<p>Some item types have what we call &#8220;canned actions&#8221;. Those are pre-defined actions attached directly to an item. Take a look at this example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">svc_upstart</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;mysql&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;running&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}}</span>

<span class="n">files</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;/etc/mysql/my.cnf&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;source&#39;</span><span class="p">:</span> <span class="s">&quot;my.cnf&quot;</span><span class="p">,</span>
        <span class="s">&#39;triggers&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">&quot;svc_upstart:mysql:reload&quot;</span><span class="p">,</span>  <span class="c"># this triggers the canned action</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Canned actions always have to be triggered in order to run. In the example above, a change in the file <code class="file docutils literal"><span class="pre">/etc/mysql/my.cnf</span></code> will trigger the <code class="docutils literal"><span class="pre">reload</span></code> action defined by the <a class="reference internal" href="item_svc_upstart.html"><em>svc_upstart item type</em></a> for the mysql service.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="metadata-py">
<span id="metadatapy"></span><h2>metadata.py<a class="headerlink" href="#metadata-py" title="Permalink to this headline">¶</a></h2>
<p>Alongside <code class="file docutils literal"><span class="pre">items.py</span></code> you may create another file called <code class="file docutils literal"><span class="pre">metadata.py</span></code>. It can be used to do advanced processing of the metadata you configured for your nodes and groups. Specifically, it allows each bundle to modify metadata before <code class="file docutils literal"><span class="pre">items.py</span></code> is evaluated. To do that, you simply write any number of functions whose name doesn&#8217;t start with an underscore and put them into <code class="file docutils literal"><span class="pre">metadata.py</span></code>. These functions take the metadata dictionary generated so far as their single argument. You may then return the same dictionary with your modifications or <cite>None</cite> if you don&#8217;t want to make further changes. These function are called metadata processors. Every metadata processor from every bundle is called repeatedly with the latest metadata dictionary until they all return <cite>None</cite>. It is vital that every metadata processor can recognize when it already has done its job and then returns <cite>None</cite> (otherwise you&#8217;ll get stuck in an infinite loop). Here&#8217;s an example for how a <code class="file docutils literal"><span class="pre">metadata.py</span></code> could look like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">my_metadata_processor</span><span class="p">(</span><span class="n">metadata</span><span class="p">):</span>
    <span class="k">if</span> <span class="s">&quot;foo&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s">&quot;foo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="s">&quot;baz&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metadata</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="item_action.html" class="btn btn-neutral float-right" title="Actions" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="groups.py.html" class="btn btn-neutral" title="groups.py" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    </p>
  </div>

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>