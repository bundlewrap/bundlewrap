<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Python API - BundleWrap</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../bundlewrap.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">BundleWrap</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link"><i class="fa fa-home"></i></a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Guides</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../quickstart/" class="dropdown-item">Quickstart</a>
</li>
                                    
<li>
    <a href="../installation/" class="dropdown-item">Installation</a>
</li>
                                    
<li>
    <a href="../cli/" class="dropdown-item">CLI</a>
</li>
                                    
<li>
    <a href="../env/" class="dropdown-item">Environment Variables</a>
</li>
                                    
<li>
    <a href="../item_file_templates/" class="dropdown-item">File templates</a>
</li>
                                    
<li>
    <a href="../secrets/" class="dropdown-item">Handling secrets</a>
</li>
                                    
<li>
    <a href="../locks/" class="dropdown-item">Locking</a>
</li>
                                    
<li>
    <a href="../kubernetes/" class="dropdown-item">Kubernetes</a>
</li>
                                    
<li>
    <a href="../dev_item/" class="dropdown-item">Custom items</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Python API</a>
</li>
                                    
<li>
    <a href="../os_compatibility/" class="dropdown-item">OS compatibility</a>
</li>
                                    
<li>
    <a href="../toml/" class="dropdown-item">TOML nodes and groups</a>
</li>
                                    
<li>
    <a href="../selectors/" class="dropdown-item">Selectors</a>
</li>
                                    
<li>
    <a href="../migrate_12/" class="dropdown-item">Migrating to 2.0</a>
</li>
                                    
<li>
    <a href="../migrate_23/" class="dropdown-item">Migrating to 3.0</a>
</li>
                                    
<li>
    <a href="../migrate_34/" class="dropdown-item">Migrating to 4.0</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Repository</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../repo/layout/" class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="../../repo/nodes.py/" class="dropdown-item">nodes.py</a>
</li>
                                    
<li>
    <a href="../../repo/groups.py/" class="dropdown-item">groups.py</a>
</li>
                                    
<li>
    <a href="../../repo/requirements.txt/" class="dropdown-item">requirements.txt</a>
</li>
                                    
<li>
    <a href="../../repo/bundle.py/" class="dropdown-item">bundles/.../bundle.py</a>
</li>
                                    
<li>
    <a href="../../repo/items.py/" class="dropdown-item">bundles/.../items.py</a>
</li>
                                    
<li>
    <a href="../../repo/metadata.py/" class="dropdown-item">bundles/.../metadata.py</a>
</li>
                                    
<li>
    <a href="../../repo/hooks/" class="dropdown-item">hooks/</a>
</li>
                                    
<li>
    <a href="../../repo/libs/" class="dropdown-item">libs/</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Items</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../items/action/" class="dropdown-item">action</a>
</li>
                                    
<li>
    <a href="../../items/dconf/" class="dropdown-item">dconf</a>
</li>
                                    
<li>
    <a href="../../items/directory/" class="dropdown-item">directory</a>
</li>
                                    
<li>
    <a href="../../items/file/" class="dropdown-item">file</a>
</li>
                                    
<li>
    <a href="../../items/git_deploy/" class="dropdown-item">git_deploy</a>
</li>
                                    
<li>
    <a href="../../items/group/" class="dropdown-item">group</a>
</li>
                                    
<li>
    <a href="../../items/k8s/" class="dropdown-item">k8s_*</a>
</li>
                                    
<li>
    <a href="../../items/pkg_apk/" class="dropdown-item">pkg_apk</a>
</li>
                                    
<li>
    <a href="../../items/pkg_apt/" class="dropdown-item">pkg_apt</a>
</li>
                                    
<li>
    <a href="../../items/pkg_dnf/" class="dropdown-item">pkg_dnf</a>
</li>
                                    
<li>
    <a href="../../items/pkg_freebsd/" class="dropdown-item">pkg_freebsd</a>
</li>
                                    
<li>
    <a href="../../items/pkg_openbsd/" class="dropdown-item">pkg_openbsd</a>
</li>
                                    
<li>
    <a href="../../items/pkg_opkg/" class="dropdown-item">pkg_opkg</a>
</li>
                                    
<li>
    <a href="../../items/pkg_pacman/" class="dropdown-item">pkg_pacman</a>
</li>
                                    
<li>
    <a href="../../items/pkg_pamac/" class="dropdown-item">pkg_pamac</a>
</li>
                                    
<li>
    <a href="../../items/pkg_pip/" class="dropdown-item">pkg_pip</a>
</li>
                                    
<li>
    <a href="../../items/pkg_snap/" class="dropdown-item">pkg_snap</a>
</li>
                                    
<li>
    <a href="../../items/pkg_yum/" class="dropdown-item">pkg_yum</a>
</li>
                                    
<li>
    <a href="../../items/pkg_zypper/" class="dropdown-item">pkg_zypper</a>
</li>
                                    
<li>
    <a href="../../items/postgres_db/" class="dropdown-item">postgres_db</a>
</li>
                                    
<li>
    <a href="../../items/postgres_role/" class="dropdown-item">postgres_role</a>
</li>
                                    
<li>
    <a href="../../items/routeros/" class="dropdown-item">routeros</a>
</li>
                                    
<li>
    <a href="../../items/svc_freebsd/" class="dropdown-item">svc_freebsd</a>
</li>
                                    
<li>
    <a href="../../items/svc_openbsd/" class="dropdown-item">svc_openbsd</a>
</li>
                                    
<li>
    <a href="../../items/svc_openrc/" class="dropdown-item">svc_openrc</a>
</li>
                                    
<li>
    <a href="../../items/svc_systemd/" class="dropdown-item">svc_systemd</a>
</li>
                                    
<li>
    <a href="../../items/svc_systemv/" class="dropdown-item">svc_systemv</a>
</li>
                                    
<li>
    <a href="../../items/svc_upstart/" class="dropdown-item">svc_upstart</a>
</li>
                                    
<li>
    <a href="../../items/symlink/" class="dropdown-item">symlink</a>
</li>
                                    
<li>
    <a href="../../items/user/" class="dropdown-item">user</a>
</li>
                                    
<li>
    <a href="../../items/zfs_dataset/" class="dropdown-item">zfs_dataset</a>
</li>
                                    
<li>
    <a href="../../items/zfs_pool/" class="dropdown-item">zfs_pool</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Misc</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../misc/about/" class="dropdown-item">About</a>
</li>
                                    
<li>
    <a href="../../misc/deciding/" class="dropdown-item">Why BundleWrap</a>
</li>
                                    
<li>
    <a href="../../misc/glossary/" class="dropdown-item">Glossary</a>
</li>
                                    
<li>
    <a href="../../misc/faq/" class="dropdown-item">FAQ</a>
</li>
                                    
<li>
    <a href="../../misc/contributing/" class="dropdown-item">Contributing</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../dev_item/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../os_compatibility/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/bundlewrap/bundlewrap/edit/master/docs/guide/api.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#api" class="nav-link">API</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#example" class="nav-link">Example</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#reference" class="nav-link">Reference</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="api">API</h1>
<p>While most users will interact with BundleWrap through the <code>bw</code> command line utility, you can also use it from your own code to extract data or further automate config management tasks.</p>
<p>Even within BundleWrap itself (e.g. templates, libs, and hooks) you are often given repo and/or node objects to work with. Their methods and attributes are documented below.</p>
<p>Some general notes on using BundleWrap's API:</p>
<ul>
<li>There can be an arbitrary amount of <code>bundlewrap.repo.Repository</code> objects per process.</li>
<li>Repositories are read as needed and not re-read when something changes. Modifying files in a repo during the lifetime of the matching Repository object may result in undefined behavior.</li>
</ul>
<p><br></p>
<h2 id="example">Example</h2>
<p>Here's a short example of how to use BundleWrap to get the uptime for a node.</p>
<pre><code>from bundlewrap.repo import Repository

repo = Repository("/path/to/my/repo")
node = repo.get_node("mynode")
uptime = node.run("uptime")
print(uptime.stdout)
</code></pre>
<p><br></p>
<h2 id="reference">Reference</h2>
<h3 id="bundlewrapreporepositorypath">bundlewrap.repo.Repository(path)</h3>
<p>The starting point of any interaction with BundleWrap. An object of this class represents the repository at the given path. <code>path</code> can be a subpath of your repository (e.g., <code>bundles/nginx/</code>) and will internally be resolved to the root path of said repository.</p>
<p><br></p>
<p><strong><code>.branch</code></strong></p>
<p>The current git branch of this repo. <code>None</code> if not in a git repo.</p>
<p><br></p>
<p><strong><code>.clean</code></strong></p>
<p>Boolean indicating if there are uncommitted changes in git. <code>None</code> if not in a git repo.</p>
<p><br></p>
<p><strong><code>.groups</code></strong></p>
<p>A list of all groups in the repo (instances of <code>bundlewrap.group.Group</code>)</p>
<p><br></p>
<p><strong><code>.nodes</code></strong></p>
<p>A list of all nodes in the repo (instances of <code>bundlewrap.node.Node</code>)</p>
<p><br></p>
<p><strong><code>.revision</code></strong></p>
<p>The current git, hg or bzr revision of this repo. <code>None</code> if no SCM was detected.</p>
<p><br></p>
<p><strong><code>.get_group(group_name)</code></strong></p>
<p>Returns the Group object for the given name.</p>
<p><br></p>
<p><strong><code>.get_node(node_name)</code></strong></p>
<p>Returns the Node object with the given name.</p>
<p><br></p>
<p><strong><code>.nodes_in_all_groups(group_names)</code></strong></p>
<p>Returns a list of Node objects where every node is a member of every group name given.</p>
<p><br></p>
<p><strong><code>.nodes_in_any_group(group_names)</code></strong></p>
<p>Returns all Node objects that are a member of at least one of the given group names.</p>
<p><br></p>
<p><strong><code>.nodes_in_group(group_name)</code></strong></p>
<p>Returns a list of Node objects in the named group.</p>
<p><br></p>
<h3 id="bundlewrapnodenode">bundlewrap.node.Node()</h3>
<p>A system managed by BundleWrap.</p>
<p><br></p>
<p><strong><code>.bundles</code></strong></p>
<p>A list of all bundles associated with this node (instances of <code>bundlewrap.bundle.Bundle</code>)</p>
<p><br></p>
<p><strong><code>.groups</code></strong></p>
<p>A list of <code>bundlewrap.group.Group</code> objects this node belongs to</p>
<p><br></p>
<p><strong><code>.hostname</code></strong></p>
<p>The DNS name BundleWrap uses to connect to this node</p>
<p><br></p>
<p><strong><code>.items</code></strong></p>
<p>A list of items on this node (instances of subclasses of <code>bundlewrap.items.Item</code>)</p>
<p><br></p>
<p><strong><code>.magic_number</code></strong></p>
<p>A large number derived from the node's name. This number is very likely to be unique for your entire repository. You can, for example, use this number to easily "jitter" cronjobs:</p>
<pre><code>'{} {} * * * root /my/script'.format(
    node.magic_number % 60,
    node.magic_number % 2 + 4,
)
</code></pre>
<p><br></p>
<p><strong><code>.metadata</code></strong></p>
<p>A dictionary of custom metadata, merged from information in <a href="../../repo/nodes.py/">nodes.py</a> and <a href="../../repo/groups.py/">groups.py</a></p>
<p><br></p>
<p><strong><code>.name</code></strong></p>
<p>The internal identifier for this node</p>
<p><br></p>
<p><strong><code>.download(remote_path, local_path)</code></strong></p>
<p>Downloads a file from the node.</p>
<ul>
<li><code>remote_path</code> Which file to get from the node</li>
<li><code>local_path</code> Where to put the file</li>
</ul>
<p><br></p>
<p><strong><code>.get_item(item_id)</code></strong></p>
<p>Get the Item object with the given ID (e.g. "file:/etc/motd").</p>
<p><br></p>
<p><strong><code>.has_bundle(bundle_name)</code></strong></p>
<p><code>True</code> if the node has a bundle with the given name.</p>
<p><br></p>
<p><strong><code>.has_any_bundle(bundle_names)</code></strong></p>
<p><code>True</code> if the node has a bundle with any of the given names.</p>
<p><br></p>
<p><strong><code>.in_group(group_name)</code></strong></p>
<p><code>True</code> if the node is in a group with the given name.</p>
<p><br></p>
<p><strong><code>.in_any_group(group_names)</code></strong></p>
<p><code>True</code> if the node is in a group with any of the given names.</p>
<p><br></p>
<p><strong><code>.run(command, may_fail=False)</code></strong></p>
<p>Runs a command on the node. Returns an instance of <code>bundlewrap.operations.RunResult</code>.</p>
<ul>
<li><code>command</code> What should be executed on the node</li>
<li><code>may_fail</code> If <code>False</code>, <code>bundlewrap.exceptions.RemoteException</code> will be raised if the command does not return 0.</li>
</ul>
<p><code>bundlewrap.exceptions.TransportException</code> will be raised if there was a transport error while running the command, e.g. the SSH process died unexpectedly.</p>
<p><br></p>
<p><strong><code>.run_ipmitool(command)</code></strong></p>
<p>Runs a command on an ipmi interface. Returns an instance of
<code>bundlewrap.operations.RunResult</code>. A command is a string of tokens which
gets passed to ipmitool. The command will be split at whitespace
characters and added to the commandline:</p>
<pre><code># runs `ipmitool -H hostname -U username -P password power status`
node.run_ipmitool('power status')
</code></pre>
<p><br></p>
<p><strong><code>.upload(local_path, remote_path, mode=None, owner="", group="")</code></strong></p>
<p>Uploads a file to the node.</p>
<ul>
<li><code>local_path</code> Which file to upload</li>
<li><code>remote_path</code> Where to put the file on the target node</li>
<li><code>mode</code> File mode, e.g. "0644"</li>
<li><code>owner</code> Username of the file owner</li>
<li><code>group</code> Group name of the file group</li>
</ul>
<p><br></p>
<h3 id="bundlewrapgroupgroup">bundlewrap.group.Group</h3>
<p>A user-defined group of nodes.</p>
<p><br></p>
<p><strong><code>.name</code></strong></p>
<p>The name of this group</p>
<p><br></p>
<p><strong><code>.nodes</code></strong></p>
<p>A list of all nodes in this group (instances of <code>bundlewrap.node.Node</code>, includes subgroup members)</p>
<p><br></p>
<h3 id="bundlewraputilsfault">bundlewrap.utils.Fault</h3>
<p>A Fault acts as a lazy stand-in object for the result of a given callback function. These objects are returned from the "vault" attached to <code>Repository</code> objects:</p>
<pre><code>&gt;&gt;&gt; repo.vault.password_for("demo")
&lt;bundlewrap.utils.Fault object at 0x10782b208&gt;
</code></pre>
<p>Only when the <code>value</code> property of a Fault is accessed or when the Fault is converted to a string, the callback function is executed. In the example above, this means that the password is only generated when it is really required (e.g. when used in a template). This is particularly useful when used in metadata in connection with <a href="../secrets/">secrets</a>. Users will be able to generate metadata with Faults in it, even if they lack the required keys for the decryption operation represented by the Fault. The key will only be required for files etc. that actually use it. If a Fault cannot be resolved (e.g. for lack of the required key), BundleWrap can just skip the item using the Fault, while still allowing other items on the same node to be applied.</p>
<p>Faults also support some rudimentary string operations such as appending a string or another Fault, as well as some string methods:</p>
<pre><code>&gt;&gt;&gt; f = repo.vault.password_for("1") + ":" + repo.vault.password_for("2")
&gt;&gt;&gt; f
&lt;bundlewrap.utils.Fault object at 0x10782b208&gt;
&gt;&gt;&gt; f.value
'VOd5PC:JUgYUb'
&gt;&gt;&gt; f += " "
&gt;&gt;&gt; f.value
'VOd5PC:JUgYUb '
&gt;&gt;&gt; f.strip().value
'VOd5PC:JUgYUb'
&gt;&gt;&gt; repo.vault.password_for("1").format_into("Password: {}").value
'Password: VOd5PC'
&gt;&gt;&gt; repo.vault.password_for("1").b64encode().value
'Vk9kNVA='
&gt;&gt;&gt; repo.vault.password_for("1").as_htpasswd_entry("username").value
'username:$apr1$8be694c7…'
</code></pre>
<p>These string methods are supported on Faults: <code>format</code>, <code>lower</code>, <code>lstrip</code>, <code>replace</code>, <code>rstrip</code>, <code>strip</code>, <code>upper</code>, <code>zfill</code></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>BundleWrap is published under the <a href='https://github.com/bundlewrap/bundlewrap/blob/master/LICENSE'>GPL license</a>.</p></p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
