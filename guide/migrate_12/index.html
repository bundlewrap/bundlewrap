<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Migrating to 2.0 - BundleWrap</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../bundlewrap.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-33891245-2', 'docs.bundlewrap.org');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">BundleWrap</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../.."><i class="fa fa-home"></i></a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Guides <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../quickstart/">Quickstart</a>
</li>
                            
<li >
    <a href="../installation/">Installation</a>
</li>
                            
<li >
    <a href="../cli/">CLI</a>
</li>
                            
<li >
    <a href="../env/">Environment Variables</a>
</li>
                            
<li >
    <a href="../item_file_templates/">File templates</a>
</li>
                            
<li >
    <a href="../secrets/">Handling secrets</a>
</li>
                            
<li >
    <a href="../locks/">Locking</a>
</li>
                            
<li >
    <a href="../dev_item/">Custom items</a>
</li>
                            
<li >
    <a href="../dev_plugin/">Writing plugins</a>
</li>
                            
<li >
    <a href="../api/">Python API</a>
</li>
                            
<li >
    <a href="../os_compatibility/">OS compatibility</a>
</li>
                            
<li class="active">
    <a href="./">Migrating to 2.0</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Repository <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../repo/layout/">Overview</a>
</li>
                            
<li >
    <a href="../../repo/nodes.py/">nodes.py</a>
</li>
                            
<li >
    <a href="../../repo/groups.py/">groups.py</a>
</li>
                            
<li >
    <a href="../../repo/requirements.txt/">requirements.txt</a>
</li>
                            
<li >
    <a href="../../repo/bundles/">bundles/</a>
</li>
                            
<li >
    <a href="../../repo/hooks/">hooks/</a>
</li>
                            
<li >
    <a href="../../repo/libs/">libs/</a>
</li>
                            
<li >
    <a href="../../repo/plugins/">Plugins</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Items <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../items/action/">action</a>
</li>
                            
<li >
    <a href="../../items/directory/">directory</a>
</li>
                            
<li >
    <a href="../../items/file/">file</a>
</li>
                            
<li >
    <a href="../../items/group/">group</a>
</li>
                            
<li >
    <a href="../../items/pkg_apt/">pkg_apt</a>
</li>
                            
<li >
    <a href="../../items/pkg_dnf/">pkg_dnf</a>
</li>
                            
<li >
    <a href="../../items/pkg_pacman/">pkg_pacman</a>
</li>
                            
<li >
    <a href="../../items/pkg_pip/">pkg_pip</a>
</li>
                            
<li >
    <a href="../../items/pkg_snap/">pkg_snap</a>
</li>
                            
<li >
    <a href="../../items/pkg_yum/">pkg_yum</a>
</li>
                            
<li >
    <a href="../../items/pkg_zypper/">pkg_zypper</a>
</li>
                            
<li >
    <a href="../../items/postgres_db/">postgres_db</a>
</li>
                            
<li >
    <a href="../../items/postgres_role/">postgres_role</a>
</li>
                            
<li >
    <a href="../../items/svc_openbsd/">svc_openbsd</a>
</li>
                            
<li >
    <a href="../../items/svc_systemd/">svc_systemd</a>
</li>
                            
<li >
    <a href="../../items/svc_systemv/">svc_systemv</a>
</li>
                            
<li >
    <a href="../../items/svc_upstart/">svc_upstart</a>
</li>
                            
<li >
    <a href="../../items/symlink/">symlink</a>
</li>
                            
<li >
    <a href="../../items/user/">user</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Misc <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../misc/about/">About</a>
</li>
                            
<li >
    <a href="../../misc/glossary/">Glossary</a>
</li>
                            
<li >
    <a href="../../misc/faq/">FAQ</a>
</li>
                            
<li >
    <a href="../../misc/alternatives/">Alternatives</a>
</li>
                            
<li >
    <a href="../../misc/contributing/">Contributing</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../os_compatibility/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../../repo/layout/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/bundlewrap/bundlewrap">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#migrating-from-bundlewrap-1x-to-2x">Migrating from BundleWrap 1.x to 2.x</a></li>
            <li><a href="#itemspy">items.py</a></li>
            <li><a href="#default-file-content-type">Default file content type</a></li>
            <li><a href="#metadata-merging">Metadata merging</a></li>
            <li><a href="#metadata-processors-and-item-generators">Metadata processors and item generators</a></li>
            <li><a href="#custom-item-types">Custom item types</a></li>
            <li><a href="#deterministic-templates">Deterministic templates</a></li>
            <li><a href="#hook-arguments">Hook arguments</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="migrating-from-bundlewrap-1x-to-2x">Migrating from BundleWrap 1.x to 2.x</h1>
<p>As per <a href="http://semver.org">semver</a>, BundleWrap 2.0 breaks compatibility with repositories created for BundleWrap 1.x. This document provides a guide on how to upgrade your repositories to BundleWrap 2.x. Please read the entire document before proceeding. To aid with the transition, BundleWrap 1.6.0 has been released along with 2.0.0. It contains no new features over 1.5.x, but has builtin helpers to aid your migration to 2.0.</p>
<p><br></p>
<h2 id="itemspy">items.py</h2>
<p>In every bundle, rename <code>bundle.py</code> to <code>items.py</code>. BundleWrap 1.6.0 can do this for you by running <code>bw migrate</code>.</p>
<p><br></p>
<h2 id="default-file-content-type">Default file content type</h2>
<p>The default <code>content_type</code> for <a href="../../items/file/">file items</a> has changed from "mako" to "text". This means that you need to check all file items that do not define an explicit content type of "mako". Some of them might be fine because you didn't really need templating, while others may need to have their <code>content_type</code> set to "mako" explicitly.</p>
<p>BundleWrap 1.6.0 will print warnings for every file item affected when running <code>bw test</code>.</p>
<p><br></p>
<h2 id="metadata-merging">Metadata merging</h2>
<p>The merging behavior for node and group metadata has changed. Instead of a simple <code>dict.update()</code>, metadata dicts are now merged recursively. See <a href="../../repo/groups.py/#metadata">the docs</a> for details.</p>
<p><br></p>
<h2 id="metadata-processors-and-item-generators">Metadata processors and item generators</h2>
<p>These two advanced features have been replaced by a single new mechanism: <a href="../../repo/bundles/#metadatapy">metadata.py</a> You will need to rethink and rewrite them.</p>
<p>BundleWrap 1.6.0 will print warnings for every group that uses metadata processors and any item generators when running <code>bw test</code>.</p>
<p><br></p>
<h2 id="custom-item-types">Custom item types</h2>
<p>The API for defining your own items has changed. Generally, you should be able to upgrade your items with relatively little effort. Refer to <a href="../dev_item/">the docs</a> for details.</p>
<p><br></p>
<h2 id="deterministic-templates">Deterministic templates</h2>
<p>While not a strict requirement, it is highly recommended to ensure your entire configuration can be created deterministically (i.e. remains exactly the same no matter how often you generate it). Otherwise, you won't be able to take advantage of the new functionality provided by <code>bw hash</code>.</p>
<p>A common pitfall here is iteration over dictionaries in templates:</p>
<pre><code>% for key, value in my_dict.items():
${value}
% endfor
</code></pre>
<p>Standard dictionaries in Python have no defined order. This may result in lines occasionally changing their position. To solve this, you can simply use <code>sorted()</code>:</p>
<pre><code>% for key, value in sorted(my_dict.items()):
${value}
% endfor
</code></pre>
<p><br></p>
<h2 id="hook-arguments">Hook arguments</h2>
<p>Some <a href="../../repo/hooks/">hooks</a> had their arguments adjusted slightly.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>BundleWrap is published under the <a href='https://github.com/bundlewrap/bundlewrap/blob/master/LICENSE'>GPL license</a>.</p><p> Donations welcome in Bitcoin <code>13AJYksqncZromPF8HvDUXsmHChAm3Y7W7</code> or Ethereum <code>0x5Eb3037e197d3C0d2E014bcfC2e027EB0AD42812</code>.</p>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
