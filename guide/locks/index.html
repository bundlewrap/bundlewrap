<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Locking - BundleWrap</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../bundlewrap.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-33891245-2', 'docs.bundlewrap.org');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">BundleWrap</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../.."><i class="fa fa-home"></i></a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Guides <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../quickstart/">Quickstart</a>
</li>
                            
<li >
    <a href="../installation/">Installation</a>
</li>
                            
<li >
    <a href="../cli/">CLI</a>
</li>
                            
<li >
    <a href="../env/">Environment Variables</a>
</li>
                            
<li >
    <a href="../item_file_templates/">File templates</a>
</li>
                            
<li >
    <a href="../secrets/">Handling secrets</a>
</li>
                            
<li class="active">
    <a href="./">Locking</a>
</li>
                            
<li >
    <a href="../dev_item/">Custom items</a>
</li>
                            
<li >
    <a href="../dev_plugin/">Writing plugins</a>
</li>
                            
<li >
    <a href="../api/">Python API</a>
</li>
                            
<li >
    <a href="../os_compatibility/">OS compatibility</a>
</li>
                            
<li >
    <a href="../migrate_12/">Migrating to 2.0</a>
</li>
                            
<li >
    <a href="../migrate_23/">Migrating to 3.0</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Repository <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../repo/layout/">Overview</a>
</li>
                            
<li >
    <a href="../../repo/nodes.py/">nodes.py</a>
</li>
                            
<li >
    <a href="../../repo/groups.py/">groups.py</a>
</li>
                            
<li >
    <a href="../../repo/requirements.txt/">requirements.txt</a>
</li>
                            
<li >
    <a href="../../repo/items.py/">bundles/.../items.py</a>
</li>
                            
<li >
    <a href="../../repo/metadata.py/">bundles/.../metadata.py</a>
</li>
                            
<li >
    <a href="../../repo/hooks/">hooks/</a>
</li>
                            
<li >
    <a href="../../repo/libs/">libs/</a>
</li>
                            
<li >
    <a href="../../repo/plugins/">Plugins</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Items <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../items/action/">action</a>
</li>
                            
<li >
    <a href="../../items/directory/">directory</a>
</li>
                            
<li >
    <a href="../../items/file/">file</a>
</li>
                            
<li >
    <a href="../../items/group/">group</a>
</li>
                            
<li >
    <a href="../../items/pkg_apt/">pkg_apt</a>
</li>
                            
<li >
    <a href="../../items/pkg_dnf/">pkg_dnf</a>
</li>
                            
<li >
    <a href="../../items/pkg_pacman/">pkg_pacman</a>
</li>
                            
<li >
    <a href="../../items/pkg_pip/">pkg_pip</a>
</li>
                            
<li >
    <a href="../../items/pkg_snap/">pkg_snap</a>
</li>
                            
<li >
    <a href="../../items/pkg_yum/">pkg_yum</a>
</li>
                            
<li >
    <a href="../../items/pkg_zypper/">pkg_zypper</a>
</li>
                            
<li >
    <a href="../../items/postgres_db/">postgres_db</a>
</li>
                            
<li >
    <a href="../../items/postgres_role/">postgres_role</a>
</li>
                            
<li >
    <a href="../../items/svc_openbsd/">svc_openbsd</a>
</li>
                            
<li >
    <a href="../../items/svc_systemd/">svc_systemd</a>
</li>
                            
<li >
    <a href="../../items/svc_systemv/">svc_systemv</a>
</li>
                            
<li >
    <a href="../../items/svc_upstart/">svc_upstart</a>
</li>
                            
<li >
    <a href="../../items/symlink/">symlink</a>
</li>
                            
<li >
    <a href="../../items/user/">user</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Misc <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../misc/about/">About</a>
</li>
                            
<li >
    <a href="../../misc/deciding/">Why BundleWrap</a>
</li>
                            
<li >
    <a href="../../misc/glossary/">Glossary</a>
</li>
                            
<li >
    <a href="../../misc/faq/">FAQ</a>
</li>
                            
<li >
    <a href="../../misc/contributing/">Contributing</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../secrets/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../dev_item/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/bundlewrap/bundlewrap">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#locking">Locking</a></li>
            <li><a href="#hard-locks">Hard locks</a></li>
            <li><a href="#soft-locks">Soft locks</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="locking">Locking</h1>
<p>BundleWrap's decentralized nature makes it necessary to coordinate actions between users of a shared repository. Locking is an important part of collaborating using BundleWrap.</p>
<h2 id="hard-locks">Hard locks</h2>
<p>Since very early in the history of BundleWrap, what we call "hard locks" were used to prevent multiple users from using <code>bw apply</code> on the same node at the same time. When BundleWrap finds a hard lock on a node in interactive mode, it will display information about who acquired the lock (and when) and will ask whether to ignore the lock or abort the process. In non-interactive mode, the operation is always cancelled for the node in question unless <code>--force</code> is used.</p>
<h2 id="soft-locks">Soft locks</h2>
<p>Many teams these days are using a workflow based on pull requests. A common problem here is that changes from a feature branch might already have been applied to a set of nodes, while the master branch is still lacking these changes. While the pull request is open and waiting for review, other users might rightly use the master branch to apply to all nodes, reverting changes made by the feature branch. This can be a major nuisance.</p>
<p>As of version 2.6.0, BundleWrap provides "soft locks" to prevent this. The author of a feature branch can now lock the node so only he or she can use <code>bw apply</code> on it:</p>
<pre><code class="nohighlight">$ bw lock add node1
✓ node1  locked with ID B9JS (expires in 8h)</code></pre>

<p>This will prevent all other users from changing any items on the node for the next 8 hours. BundleWrap will tell users apart by their <a href="../env/#BW_IDENTITY">BW_IDENTITY</a>. Now say someone else is reviewing the pull request and wants to use <code>bw apply</code>, while still keeping others out and the original author in. This can be done by simply locking the node <em>again</em> as the reviewer. Nodes can have many soft locks. Soft locks act as an exemption from a general ban on changing items that goes into effect as soon as one or more soft locks are present on the node. Of course, if no soft locks are present, anyone can change any item.</p>
<p>You can list all soft locks on a node with:</p>
<pre><code class="nohighlight">$ bw lock show node1
i node1  ID    Created              Expires              User   Items  Comment
› node1  Y1KD  2016-05-25 21:30:25  2016-05-26 05:30:25  alice  *      locks are awesome
› node1  B9JS  2016-05-24 13:10:11  2016-05-27 08:10:11  bob    *      me too</code></pre>

<p>Note that each lock is identified by a case-insensitive 4-character ID that can be used to remove the lock:</p>
<pre><code class="nohighlight">$ bw lock remove node1 y1kd
✓ node1  lock Y1KD removed</code></pre>

<p>Expired locks are automatically and silently purged whenever BundleWrap has the opportunity. Be sure to check out <code>bw lock add --help</code> for how to customize expiration time, add a short comment explaining the reason for the lock, or lock only certain items. Using <code>bw apply</code> on a soft locked node is not an error and affected items will simply be skipped.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>BundleWrap is published under the <a href='https://github.com/bundlewrap/bundlewrap/blob/master/LICENSE'>GPL license</a>.</p><p> Donations welcome in Bitcoin <code>13AJYksqncZromPF8HvDUXsmHChAm3Y7W7</code> or Ethereum <code>0x5Eb3037e197d3C0d2E014bcfC2e027EB0AD42812</code>.</p>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
