<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>groups.py - BundleWrap</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../bundlewrap.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-33891245-2', 'docs.bundlewrap.org');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">BundleWrap</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../.."><i class="fa fa-home"></i></a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Guides <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../guide/quickstart/">Quickstart</a>
</li>
                            
<li >
    <a href="../../guide/installation/">Installation</a>
</li>
                            
<li >
    <a href="../../guide/cli/">CLI</a>
</li>
                            
<li >
    <a href="../../guide/env/">Environment Variables</a>
</li>
                            
<li >
    <a href="../../guide/item_file_templates/">File templates</a>
</li>
                            
<li >
    <a href="../../guide/secrets/">Handling secrets</a>
</li>
                            
<li >
    <a href="../../guide/locks/">Locking</a>
</li>
                            
<li >
    <a href="../../guide/dev_item/">Custom items</a>
</li>
                            
<li >
    <a href="../../guide/dev_plugin/">Writing plugins</a>
</li>
                            
<li >
    <a href="../../guide/api/">Python API</a>
</li>
                            
<li >
    <a href="../../guide/os_compatibility/">OS compatibility</a>
</li>
                            
<li >
    <a href="../../guide/migrate_12/">Migrating to 2.0</a>
</li>
                            
<li >
    <a href="../../guide/migrate_23/">Migrating to 3.0</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Repository <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../layout/">Overview</a>
</li>
                            
<li >
    <a href="../nodes.py/">nodes.py</a>
</li>
                            
<li class="active">
    <a href="./">groups.py</a>
</li>
                            
<li >
    <a href="../requirements.txt/">requirements.txt</a>
</li>
                            
<li >
    <a href="../items.py/">bundles/.../items.py</a>
</li>
                            
<li >
    <a href="../metadata.py/">bundles/.../metadata.py</a>
</li>
                            
<li >
    <a href="../hooks/">hooks/</a>
</li>
                            
<li >
    <a href="../libs/">libs/</a>
</li>
                            
<li >
    <a href="../plugins/">Plugins</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Items <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../items/action/">action</a>
</li>
                            
<li >
    <a href="../../items/directory/">directory</a>
</li>
                            
<li >
    <a href="../../items/file/">file</a>
</li>
                            
<li >
    <a href="../../items/group/">group</a>
</li>
                            
<li >
    <a href="../../items/pkg_apt/">pkg_apt</a>
</li>
                            
<li >
    <a href="../../items/pkg_dnf/">pkg_dnf</a>
</li>
                            
<li >
    <a href="../../items/pkg_openbsd/">pkg_openbsd</a>
</li>
                            
<li >
    <a href="../../items/pkg_opkg/">pkg_opkg</a>
</li>
                            
<li >
    <a href="../../items/pkg_pacman/">pkg_pacman</a>
</li>
                            
<li >
    <a href="../../items/pkg_pip/">pkg_pip</a>
</li>
                            
<li >
    <a href="../../items/pkg_snap/">pkg_snap</a>
</li>
                            
<li >
    <a href="../../items/pkg_yum/">pkg_yum</a>
</li>
                            
<li >
    <a href="../../items/pkg_zypper/">pkg_zypper</a>
</li>
                            
<li >
    <a href="../../items/postgres_db/">postgres_db</a>
</li>
                            
<li >
    <a href="../../items/postgres_role/">postgres_role</a>
</li>
                            
<li >
    <a href="../../items/svc_openbsd/">svc_openbsd</a>
</li>
                            
<li >
    <a href="../../items/svc_systemd/">svc_systemd</a>
</li>
                            
<li >
    <a href="../../items/svc_systemv/">svc_systemv</a>
</li>
                            
<li >
    <a href="../../items/svc_upstart/">svc_upstart</a>
</li>
                            
<li >
    <a href="../../items/symlink/">symlink</a>
</li>
                            
<li >
    <a href="../../items/user/">user</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Misc <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../misc/about/">About</a>
</li>
                            
<li >
    <a href="../../misc/deciding/">Why BundleWrap</a>
</li>
                            
<li >
    <a href="../../misc/glossary/">Glossary</a>
</li>
                            
<li >
    <a href="../../misc/faq/">FAQ</a>
</li>
                            
<li >
    <a href="../../misc/contributing/">Contributing</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../nodes.py/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../requirements.txt/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/bundlewrap/bundlewrap/edit/master/docs/repo/groups.py.md"><i class="fa fa-github"></i> Edit on GitHub</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#groupspy">groups.py</a></li>
        <li class="main "><a href="#group-attribute-reference">Group attribute reference</a></li>
            <li><a href="#member_patterns">member_patterns</a></li>
            <li><a href="#members">members</a></li>
            <li><a href="#members_add-and-members_remove">members_add and members_remove</a></li>
            <li><a href="#metadata">metadata</a></li>
            <li><a href="#subgroups">subgroups</a></li>
            <li><a href="#subgroup_patterns">subgroup_patterns</a></li>
            <li><a href="#use_shadow_passwords">use_shadow_passwords</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="groupspy">groups.py</h1>
<p>This file lets you specify or dynamically build groups of <a href="../nodes.py/">nodes</a> in your environment.</p>
<p>As with <code>nodes.py</code>, you define your groups as a dictionary:</p>
<pre><code>groups = {
    'all': {
        'member_patterns': (
            r".*",
        ),
    },
    'group1': {
        'members': (
            'node1',
        ),
    },
}
</code></pre>
<p>All group attributes are optional.</p>
<p><br></p>
<h1 id="group-attribute-reference">Group attribute reference</h1>
<p>This section is a reference for all possible attributes you can define for a group:</p>
<pre><code>groups = {
     'group1': {
         # THIS PART IS EXPLAINED HERE
         'bundles': ["bundle1", "bundle2"],
         'members': ["node1"],
         'members_add': lambda node: node.os == 'debian',
         'members_remove': lambda node: node.os == 'ubuntu',
         'member_patterns': [r"^cluster1\."],
         'metadata': {'foo': "bar"},
         'os': 'linux',
         'subgroups': ["group2", "group3"],
         'subgroup_patterns': [r"^group.*pattern$"],
     },
}
</code></pre>
<p>Note that many attributes from <a href="../nodes.py/">nodes.py</a> (e.g. <code>bundles</code>) may also be set at group level, but aren't explicitly documented here again.</p>
<p><br></p>
<h2 id="member_patterns">member_patterns</h2>
<p>A list of regular expressions. Node names matching these expressions will be added to the group members.</p>
<p>Matches are determined using <a href="http://docs.python.org/2/library/re.html#re.RegexObject.search">the search() method</a>.</p>
<p><br></p>
<h2 id="members">members</h2>
<p>A tuple or list of node names that belong to this group.</p>
<p><br></p>
<h2 id="members_add-and-members_remove">members_add and members_remove</h2>
<p>For these attributes you can provide a function that takes a node object as its only argument. The function must return a boolean. The function will be called once for every node in the repo. If <code>True</code>, this node will be added (<code>members_add</code>) to or removed (<code>members_remove</code>) from this group.</p>
<div class="alert alert-warning">Inside your function you may query node attributes and groups, but you will not see groups or attributes added as a result of a different <code>members_add</code> / <code>members_remove</code> function. Only attributes and groups that have been set statically will be available. You can, however, remove a node with <code>members_remove</code> that you added with <code>members_add</code> (but not vice-versa).<br>You should also avoid using <code>node.metadata</code> here. Since metadata ultimately depends on group memberships, only metadata set in <code>nodes.py</code> will be returned here.</div>

<p><br></p>
<h2 id="metadata">metadata</h2>
<p>A dictionary that will be accessible from each node's <code>node.metadata</code>. For each node, BundleWrap will merge the metadata of all of the node's groups first, then merge in the metadata from the node itself.</p>
<p>Metadata is merged recursively by default, meaning nested dicts will overlay each other. Lists will be appended to each other, but not recursed into. In come cases, you want to overwrite instead of merge a piece of metadata. This is accomplished through the use of <code>bundlewrap.metadata.atomic()</code> and best illustrated as an example:</p>
<pre><code>from bundlewrap.metadata import atomic

groups = {
    'all': {
        'metadata': {
            'interfaces': {
                'eth0': {},
            },
            'nameservers': ["8.8.8.8", "8.8.4.4"],
            'ntp_servers': ["pool.ntp.org"],
        },
    },
    'internal': {
        'metadata':
            'interfaces': {
                'eth1': {},
            },
            'nameservers': atomic(["10.0.0.1", "10.0.0.2"]),
            'ntp_servers': ["10.0.0.1", "10.0.0.2"],
        },
    },
}
</code></pre>
<p>A node in both groups will end up with <code>eth0</code> <em>and</em> <code>eth1</code>.</p>
<p>The nameservers however are overwritten, so that nodes what are in both the "all" <em>and</em> the "internal" group will only have the <code>10.0.0.x</code> ones while nodes just in the "all" group will have the <code>8.8.x.x</code> nameservers.</p>
<p>The NTP servers are appended: a node in both groups will have all three nameservers.</p>
<div class="alert alert-warning">BundleWrap will consider group hierarchy when merging metadata. For example, it is possible to define a default nameserver for the "eu" group and then override it for the "eu.frankfurt" subgroup. The catch is that this only works for groups that are connected through a subgroup hierarchy. Independent groups will have their metadata merged in an undefined order. <code>bw test</code> will report conflicting metadata in independent groups as a metadata collision.</div>

<div class="alert alert-info">Also see the <a href="../nodes.py#metadata">documentation for node.metadata</a> for more information.</div>

<p><br></p>
<h2 id="subgroups">subgroups</h2>
<p>A tuple or list of group names whose members should be recursively included in this group.</p>
<p><br></p>
<h2 id="subgroup_patterns">subgroup_patterns</h2>
<p>A list of regular expressions. Nodes in with group names matching these expressions will be added to the group members.</p>
<p>Matches are determined using <a href="http://docs.python.org/2/library/re.html#re.RegexObject.search">the search() method</a>.</p>
<p><br></p>
<h2 id="use_shadow_passwords">use_shadow_passwords</h2>
<p>See <a href="../nodes.py/#use_shadow_passwords">node attribute documentation</a>. May be overridden by subgroups or individual nodes.</p>
<p><br></p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>BundleWrap is published under the <a href='https://github.com/bundlewrap/bundlewrap/blob/master/LICENSE'>GPL license</a>.</p><p> Donations welcome in Bitcoin <code>13AJYksqncZromPF8HvDUXsmHChAm3Y7W7</code> or Ethereum <code>0x5Eb3037e197d3C0d2E014bcfC2e027EB0AD42812</code>.</p>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script src="../../js/base.js"></script>
        <script src="../../search/require.js"></script>
        <script src="../../search/search.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td><kbd>&larr;</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td><kbd>&rarr;</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>


    </body>
</html>
