<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>nodes.py - BundleWrap</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../bundlewrap.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">BundleWrap</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link"><i class="fa fa-home"></i></a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Guides</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../guide/quickstart/" class="dropdown-item">Quickstart</a>
</li>
                                    
<li>
    <a href="../../guide/installation/" class="dropdown-item">Installation</a>
</li>
                                    
<li>
    <a href="../../guide/cli/" class="dropdown-item">CLI</a>
</li>
                                    
<li>
    <a href="../../guide/env/" class="dropdown-item">Environment Variables</a>
</li>
                                    
<li>
    <a href="../../guide/item_file_templates/" class="dropdown-item">File templates</a>
</li>
                                    
<li>
    <a href="../../guide/secrets/" class="dropdown-item">Handling secrets</a>
</li>
                                    
<li>
    <a href="../../guide/locks/" class="dropdown-item">Locking</a>
</li>
                                    
<li>
    <a href="../../guide/kubernetes/" class="dropdown-item">Kubernetes</a>
</li>
                                    
<li>
    <a href="../../guide/dev_item/" class="dropdown-item">Custom items</a>
</li>
                                    
<li>
    <a href="../../guide/api/" class="dropdown-item">Python API</a>
</li>
                                    
<li>
    <a href="../../guide/os_compatibility/" class="dropdown-item">OS compatibility</a>
</li>
                                    
<li>
    <a href="../../guide/toml/" class="dropdown-item">TOML nodes and groups</a>
</li>
                                    
<li>
    <a href="../../guide/selectors/" class="dropdown-item">Selectors</a>
</li>
                                    
<li>
    <a href="../../guide/migrate_12/" class="dropdown-item">Migrating to 2.0</a>
</li>
                                    
<li>
    <a href="../../guide/migrate_23/" class="dropdown-item">Migrating to 3.0</a>
</li>
                                    
<li>
    <a href="../../guide/migrate_34/" class="dropdown-item">Migrating to 4.0</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Repository</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../layout/" class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">nodes.py</a>
</li>
                                    
<li>
    <a href="../groups.py/" class="dropdown-item">groups.py</a>
</li>
                                    
<li>
    <a href="../requirements.txt/" class="dropdown-item">requirements.txt</a>
</li>
                                    
<li>
    <a href="../bundle.py/" class="dropdown-item">bundles/.../bundle.py</a>
</li>
                                    
<li>
    <a href="../items.py/" class="dropdown-item">bundles/.../items.py</a>
</li>
                                    
<li>
    <a href="../metadata.py/" class="dropdown-item">bundles/.../metadata.py</a>
</li>
                                    
<li>
    <a href="../hooks/" class="dropdown-item">hooks/</a>
</li>
                                    
<li>
    <a href="../libs/" class="dropdown-item">libs/</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Items</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../items/action/" class="dropdown-item">action</a>
</li>
                                    
<li>
    <a href="../../items/dconf/" class="dropdown-item">dconf</a>
</li>
                                    
<li>
    <a href="../../items/directory/" class="dropdown-item">directory</a>
</li>
                                    
<li>
    <a href="../../items/file/" class="dropdown-item">file</a>
</li>
                                    
<li>
    <a href="../../items/git_deploy/" class="dropdown-item">git_deploy</a>
</li>
                                    
<li>
    <a href="../../items/group/" class="dropdown-item">group</a>
</li>
                                    
<li>
    <a href="../../items/k8s/" class="dropdown-item">k8s_*</a>
</li>
                                    
<li>
    <a href="../../items/pkg_apk/" class="dropdown-item">pkg_apk</a>
</li>
                                    
<li>
    <a href="../../items/pkg_apt/" class="dropdown-item">pkg_apt</a>
</li>
                                    
<li>
    <a href="../../items/pkg_dnf/" class="dropdown-item">pkg_dnf</a>
</li>
                                    
<li>
    <a href="../../items/pkg_freebsd/" class="dropdown-item">pkg_freebsd</a>
</li>
                                    
<li>
    <a href="../../items/pkg_openbsd/" class="dropdown-item">pkg_openbsd</a>
</li>
                                    
<li>
    <a href="../../items/pkg_opkg/" class="dropdown-item">pkg_opkg</a>
</li>
                                    
<li>
    <a href="../../items/pkg_pacman/" class="dropdown-item">pkg_pacman</a>
</li>
                                    
<li>
    <a href="../../items/pkg_pamac/" class="dropdown-item">pkg_pamac</a>
</li>
                                    
<li>
    <a href="../../items/pkg_pip/" class="dropdown-item">pkg_pip</a>
</li>
                                    
<li>
    <a href="../../items/pkg_snap/" class="dropdown-item">pkg_snap</a>
</li>
                                    
<li>
    <a href="../../items/pkg_yum/" class="dropdown-item">pkg_yum</a>
</li>
                                    
<li>
    <a href="../../items/pkg_zypper/" class="dropdown-item">pkg_zypper</a>
</li>
                                    
<li>
    <a href="../../items/postgres_db/" class="dropdown-item">postgres_db</a>
</li>
                                    
<li>
    <a href="../../items/postgres_role/" class="dropdown-item">postgres_role</a>
</li>
                                    
<li>
    <a href="../../items/routeros/" class="dropdown-item">routeros</a>
</li>
                                    
<li>
    <a href="../../items/svc_freebsd/" class="dropdown-item">svc_freebsd</a>
</li>
                                    
<li>
    <a href="../../items/svc_openbsd/" class="dropdown-item">svc_openbsd</a>
</li>
                                    
<li>
    <a href="../../items/svc_openrc/" class="dropdown-item">svc_openrc</a>
</li>
                                    
<li>
    <a href="../../items/svc_systemd/" class="dropdown-item">svc_systemd</a>
</li>
                                    
<li>
    <a href="../../items/svc_systemv/" class="dropdown-item">svc_systemv</a>
</li>
                                    
<li>
    <a href="../../items/svc_upstart/" class="dropdown-item">svc_upstart</a>
</li>
                                    
<li>
    <a href="../../items/symlink/" class="dropdown-item">symlink</a>
</li>
                                    
<li>
    <a href="../../items/user/" class="dropdown-item">user</a>
</li>
                                    
<li>
    <a href="../../items/zfs_dataset/" class="dropdown-item">zfs_dataset</a>
</li>
                                    
<li>
    <a href="../../items/zfs_pool/" class="dropdown-item">zfs_pool</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Misc</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../misc/about/" class="dropdown-item">About</a>
</li>
                                    
<li>
    <a href="../../misc/deciding/" class="dropdown-item">Why BundleWrap</a>
</li>
                                    
<li>
    <a href="../../misc/glossary/" class="dropdown-item">Glossary</a>
</li>
                                    
<li>
    <a href="../../misc/faq/" class="dropdown-item">FAQ</a>
</li>
                                    
<li>
    <a href="../../misc/contributing/" class="dropdown-item">Contributing</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../layout/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../groups.py/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/bundlewrap/bundlewrap/edit/master/docs/repo/nodes.py.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#nodespy" class="nav-link">nodes.py</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#dynamic-node-list" class="nav-link">Dynamic node list</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#one-file-per-node" class="nav-link">One file per node</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#node-attribute-reference" class="nav-link">Node attribute reference</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#regular-attributes" class="nav-link">Regular attributes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#os-compatibility-overrides" class="nav-link">OS compatibility overrides</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#dynamic-node-attributes" class="nav-link">Dynamic node attributes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="nodespy">nodes.py</h1>
<p>This file lets you specify or dynamically build a list of nodes in your environment.</p>
<p>All you have to do here is define a Python dictionary called <code>nodes</code>. It should look something like this:</p>
<pre><code>nodes = {
    "node-1": {
        'hostname': "node-1.example.com",
    },
}
</code></pre>
<p>With BundleWrap, the DNS name and the internal identifier for a node ("node-1" in this case) are two separate things.</p>
<p>All fields for a node (including <code>hostname</code>) are optional. If you don't give one, BundleWrap will attempt to use the internal identifier to connect to a node:</p>
<pre><code>nodes = {
    "node-1.example.com": {},
}
</code></pre>
<p><br></p>
<h1 id="dynamic-node-list">Dynamic node list</h1>
<p>You are not confined to the static way of defining a node list as shown above. You can also assemble the <code>nodes</code> dictionary dynamically:</p>
<pre><code>def get_my_nodes_from_ldap():
    [...]
    return ldap_nodes

nodes = get_my_nodes_from_ldap()
</code></pre>
<p><br></p>
<h1 id="one-file-per-node">One file per node</h1>
<p>Especially in larger installations, a single nodes.py can become inconvenient to work with. This example reads nodes from a <code>nodes/</code> directory.</p>
<pre><code>from glob import glob
from os.path import join

nodes = {}
for node in glob(join(repo_path, "nodes", "*.py")):
    with open(node, 'r') as f:
        exec(f.read())
</code></pre>
<p>Node files would then append <code>nodes</code>, like this:</p>
<pre><code># nodes/node-1.py
nodes['node-1'] = {
    'hostname': "node-1.example.com",
}
</code></pre>
<p>Alternatively, consider using <a href="../../guide/toml/">TOML nodes</a>.</p>
<p><br></p>
<h1 id="node-attribute-reference">Node attribute reference</h1>
<p>This section is a reference for all possible attributes you can define for a node:</p>
<pre><code>nodes = {
    'node-1': {
        # THIS PART IS EXPLAINED HERE
    },
}
</code></pre>
<p>All attributes can also be set at the group level, unless noted otherwise.</p>
<p><br></p>
<h2 id="regular-attributes">Regular attributes</h2>
<h3 id="bundles">bundles</h3>
<p>A list of bundle names to be assigned to this node. Bundles set at <a href="../groups.py/">group level</a> will be added.</p>
<p><br></p>
<h3 id="dummy">dummy</h3>
<p>Set this to <code>True</code> to prevent BundleWrap from creating items for and connecting to this node. This is useful for unmanaged nodes because you can still assign them bundles and metadata like regular nodes and access that from managed nodes (e.g. for monitoring).</p>
<p><br></p>
<h3 id="groups">groups</h3>
<p>A list of group names this node should be added to. Be aware that you can also define group members at the group itself and you probably should not use both methods in parallel to avoid confusion.</p>
<p>Cannot be set at group level.</p>
<p><br></p>
<h3 id="hostname">hostname</h3>
<p>A string used as a DNS name when connecting to this node. May also be an IP address.</p>
<div class="alert alert-info">The username and SSH private key for connecting to the node cannot be configured in BundleWrap. If you need to customize those, BundleWrap will honor your <code>~/.ssh/config</code>.</div>

<p>Cannot be set at group level.</p>
<p><br></p>
<h3 id="ipmi_hostname-ipmi_username-ipmi_password-ipmi_interface">ipmi_hostname, ipmi_username, ipmi_password, ipmi_interface</h3>
<p>A dictionary defining the nodes ipmi connection (if available). Will only be used with <code>bw ipmi</code> commands.</p>
<p>Using <code>ipmi_interface</code> is optional and will default to whatever <code>ipmitool</code> uses as default. See <code>ipmitool --help</code> for possible options.</p>
<p><br></p>
<h3 id="metadata">metadata</h3>
<p>This can be a dictionary of arbitrary data (some type restrictions apply). You can access it from your templates as <code>node.metadata</code>. Use this to attach custom data (such as a list of IP addresses that should be configured on the target node) to the node. Note that you can also define metadata at the <a href="../groups.py/#metadata">group level</a>, but node metadata has higher priority.</p>
<p>You are restricted to using only the following types in metadata:</p>
<ul>
<li><code>dict</code></li>
<li><code>list</code></li>
<li><code>tuple</code></li>
<li><code>set</code></li>
<li><code>bool</code></li>
<li><code>text</code> / <code>unicode</code></li>
<li><code>bytes</code> / <code>str</code> (only if decodable into text using UTF-8)</li>
<li><code>int</code></li>
<li><code>None</code></li>
<li><code>bundlewrap.utils.Fault</code></li>
</ul>
<div class="alert alert-info">Also see the <a href="../groups.py#metadata">documentation for group.metadata</a> and <a href="../metadata.py#Priority">metadata.py</a> for more information.</div>

<p><br></p>
<h3 id="os">os</h3>
<p>Defaults to <code>"linux"</code>.</p>
<p>A list of supported OSes can be obtained with <code>bw debug -n ANY_NODE_NAME -c "print(node.OS_KNOWN)"</code>.</p>
<p><br></p>
<h3 id="os_version">os_version</h3>
<p>Set this to your OS version. Note that it must be a tuple of integers, e.g. if you're running Ubuntu 16.04 LTS, it should be <code>(16, 4)</code>.</p>
<p>Tuples of integers can be used for easy comparison of versions: <code>(12, 4) &lt; (16, 4)</code></p>
<p><br></p>
<h3 id="password">password</h3>
<p>Which password to use when connecting to the node. Currently only supported for RouterOS.</p>
<p><br></p>
<h3 id="username">username</h3>
<p>Which username to use when connecting to the node. Leave this unset to use SSH configuration instead (recommended).</p>
<p><br></p>
<h2 id="os-compatibility-overrides">OS compatibility overrides</h2>
<h3 id="cmd_wrapper_outer">cmd_wrapper_outer</h3>
<p>Used whenever a command needs to be run on a node. Defaults to <code>"sudo sh -c {}"</code>. <code>{}</code> will be replaced by the quoted command to be run (after <code>cmd_wrapper_inner</code> has been applied).</p>
<p>You will need to override this if you're not using <code>sudo</code> to gain root privileges (e.g. <code>doas</code>) on the node.</p>
<p><br></p>
<h3 id="cmd_wrapper_inner">cmd_wrapper_inner</h3>
<p>Used whenever a command needs to be run on a node. Defaults to <code>"export LANG=C; {}"</code>. <code>{}</code> will be replaced by the command to be run.</p>
<p>You will need to override this if the shell on your node sets environment variables differently.</p>
<p><br></p>
<h3 id="lock_dir">lock_dir</h3>
<p>Directory that will be used for creating <a href="../../guide/locks/">locks</a> on the node. Defaults to <code>"/var/lib/bundlewrap"</code>. Will be created if it does not exist.</p>
<p>You will need to override this if <code>/var/lib</code> is restricted somehow on your node (SElinux, mounted readonly, etc.).</p>
<p><br></p>
<h3 id="pip_command">pip_command</h3>
<p>This setting will affect how <a href="../../items/pkg_pip/">pkg_pip</a> will behave. By default, it will use whatever <code>pip</code> on your system defaults to.</p>
<p>You will need to override this if you don't have <code>pip</code>, but (for example) only <code>pip3</code>. Be aware that this setting has no effect when using virtualenvs.</p>
<p><br></p>
<h3 id="use_shadow_passwords">use_shadow_passwords</h3>
<div class="alert alert-warning">Changing this setting will affect the security of the target system. Only do this for legacy systems that don't support shadow passwords.</div>

<p>This setting will affect how the <a href="../../items/user/">user item</a> item operates. If set to <code>False</code>, password hashes will be written directly to <code>/etc/passwd</code> and thus be accessible to any user on the system. If the OS of the node is set to "openbsd", this setting has no effect as <code>master.shadow</code> is always used.</p>
<p><br></p>
<h2 id="dynamic-node-attributes">Dynamic node attributes</h2>
<p>You can define callbacks that will act as read-only node attributes at runtime. For example:</p>
<pre><code>@node_attribute
def uptime(node):
    return node.run("uptime").stdout.decode().strip()
</code></pre>
<p>After adding this to your <code>nodes.py</code>, you can then get an overview of all your uptimes using <code>bw nodes -a uptime</code> or make use of <code>node.uptime</code> in your bundles and other places where you have access to node objects.</p>
<p>Be mindful when using this feature: The primary intended purpose of this is usage with <code>bw nodes -a</code> (so you can see builtin attributes, metadata, and <code>node.run()</code> results in a single table). It is <strong>not</strong> recommended that you derive configuration from these attributes if they're using <code>node.run()</code>. Doing so will make <code>bw test</code> dependent on node access and availability, while also making <code>bw hash</code> non-deterministic.</p>
<p><br></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>BundleWrap is published under the <a href='https://github.com/bundlewrap/bundlewrap/blob/master/LICENSE'>GPL license</a>.</p></p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
